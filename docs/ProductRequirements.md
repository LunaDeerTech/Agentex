# Agentex 产品需求文档 (PRD)

## 文档信息

| 项目 | 内容 |
|------|------|
| 产品名称 | Agentex |
| 版本 | 1.0.0 |
| 文档版本 | 1.0 |
| 更新日期 | 2026-02-03 |

---

## 1. 产品概述

### 1.1 产品定位

Agentex 是一个面向企业和开发者的智能 AI Agent 平台，提供统一的 AI Agent 交互、管理和编排能力。用户可以通过该平台：

- 与多种大语言模型进行对话交互
- 利用 MCP 工具扩展 Agent 能力
- 管理和调用知识库实现 RAG 增强
- 定义和执行 SKILL 技能
- 配置规则引擎实现自动化任务

### 1.2 目标用户

| 用户角色 | 描述 | 主要需求 |
|---------|------|---------|
| 普通用户 | 日常使用 Agent 进行对话和任务执行 | 便捷的对话界面、工具选择 |
| 开发者 | 开发和配置 Agent 能力 | SKILL 编写、规则配置、MCP 连接 |
| 管理员 | 系统管理和用户管理 | 用户权限、模型配置、系统设置 |

### 1.3 产品目标

1. **易用性**：提供直观的用户界面，降低使用门槛
2. **扩展性**：支持多种 Agent 架构，便于未来扩展
3. **灵活性**：支持多模型、多工具、多知识库的灵活组合
4. **安全性**：完善的权限控制和多用户隔离

---

## 2. 功能需求

### 2.1 MCP 能力模块

#### 2.1.1 功能描述

MCP（Model Context Protocol）能力模块使 Agent 能够连接和调用外部工具服务，扩展 Agent 的能力边界。

#### 2.1.2 标准 MCP 客户端

**功能说明：**
- 支持连接标准的 MCP Server（基于 HTTP SSE 协议）
- 管理 MCP Server 连接配置
- 自动发现和展示可用工具列表
- 支持工具调用和结果返回

**用户故事：**
- 作为用户，我希望能够添加标准 MCP Server 连接，以便使用外部工具
- 作为用户，我希望能够查看已连接 Server 提供的工具列表
- 作为用户，我希望 Agent 能够自动调用合适的工具完成任务

**配置项：**
| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| name | string | 是 | 连接名称 |
| url | string | 是 | MCP Server 地址 |
| authType | enum | 是 | 认证类型：none/bearer/basic |
| authToken | string | 否 | 认证令牌 |
| enabled | boolean | 是 | 是否启用 |

#### 2.1.3 扩展 WS-MCP 客户端

**功能说明：**
- 支持连接自定义的 WebSocket MCP Server
- 支持基于 Token 的认证机制
- 支持接收服务端事件通知
- 支持心跳保活机制

**扩展特性：**
| 特性 | 说明 |
|------|------|
| 权限控制 | 基于 Token 的认证，支持细粒度权限 |
| 事件通知 | 服务端可主动推送事件通知 |
| 心跳机制 | 自动心跳保活，断线重连 |
| 会话管理 | 支持会话状态管理 |

**配置项：**
| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| name | string | 是 | 连接名称 |
| wsUrl | string | 是 | WebSocket 地址 |
| authToken | string | 是 | 认证令牌 |
| heartbeatInterval | number | 否 | 心跳间隔（毫秒） |
| reconnectDelay | number | 否 | 重连延迟（毫秒） |
| maxRetries | number | 否 | 最大重试次数 |
| enabled | boolean | 是 | 是否启用 |

---

### 2.2 规则引擎模块

#### 2.2.1 功能描述

规则引擎允许用户定义基于事件触发的自动化规则，当 WS-MCP-Server 推送特定事件时，自动执行预定义的任务。

#### 2.2.2 核心概念

**事件（Event）：**
- 来源：WS-MCP-Server 推送的事件
- 属性：事件类型、事件数据、时间戳
- 示例：`player_join`、`block_change`、`chat_message`

**条件（Condition）：**
- 对事件数据的过滤和判断
- 支持多条件组合（AND/OR）
- 支持比较运算符（==、!=、>、<、>=、<=、contains、matches）

**动作（Action）：**
- 执行 SKILL
- 调用 MCP 工具
- 发送通知
- 触发其他规则

#### 2.2.3 规则定义

```yaml
# 规则结构示例（仅用于说明，非实际配置格式）
rule:
  id: rule_001
  name: "玩家进入欢迎"
  description: "当玩家进入游戏时发送欢迎消息"
  enabled: true
  trigger:
    event: "player_join"
    source: "minecraft-mcp-server"
  conditions:
    - field: "player.name"
      operator: "!="
      value: "admin"
  actions:
    - type: "mcp_call"
      tool: "chat_broadcast"
      params:
        message: "欢迎 {{player.name}} 进入游戏！"
  cooldown: 5000  # 冷却时间（毫秒）
```

#### 2.2.4 可视化配置

**功能要求：**
- 拖拽式规则编辑器
- 事件选择器（从已连接的 WS-MCP 获取可用事件）
- 条件构建器（可视化构建条件表达式）
- 动作配置器（配置执行动作）
- 规则测试功能
- 规则启用/禁用开关

---

### 2.3 模型管理模块

#### 2.3.1 功能描述

模型管理模块提供对多个 LLM 大模型的统一管理，支持 OpenAI 协议和 Anthropic 协议的模型。

#### 2.3.2 支持的协议

**OpenAI 协议：**
- OpenAI 官方模型（GPT-4、GPT-4o 等）
- 兼容 OpenAI 协议的第三方模型（如 DeepSeek、通义千问等）
- 本地部署的 OpenAI 兼容模型（如 Ollama、vLLM 等）

**Anthropic 协议：**
- Anthropic 官方模型（Claude 3、Claude 3.5 等）
- 兼容 Anthropic 协议的代理服务

#### 2.3.3 模型配置

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| name | string | 是 | 模型显示名称 |
| provider | enum | 是 | 提供商：openai/anthropic |
| baseUrl | string | 是 | API 基础地址 |
| apiKey | string | 是 | API 密钥 |
| modelId | string | 是 | 模型 ID |
| maxTokens | number | 否 | 最大 Token 数 |
| temperature | number | 否 | 温度参数 |
| enabled | boolean | 是 | 是否启用 |
| isDefault | boolean | 否 | 是否为默认模型 |

#### 2.3.4 功能要求

- 模型列表管理（增删改查）
- 模型连接测试
- 模型使用统计
- 默认模型设置
- 按用户分配模型权限

---

### 2.4 SKILL 能力模块

#### 2.4.1 功能描述

SKILL 是一种以 Markdown 格式定义的技能模板，允许用户创建可复用的任务模板。Agent 可以根据用户输入选择和执行合适的 SKILL。

#### 2.4.2 SKILL 结构

```markdown
# SKILL: 技能名称

## 描述
技能的功能描述，用于 Agent 理解何时使用此技能。

## 触发条件
描述触发此技能的条件或关键词。

## 输入参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| param1 | string | 是 | 参数说明 |

## 执行步骤
1. 第一步操作说明
2. 第二步操作说明
3. ...

## 输出格式
描述技能执行完成后的输出格式。

## 示例
提供使用示例。
```

#### 2.4.3 功能要求

- SKILL 列表管理（增删改查）
- SKILL 编辑器（Markdown 编辑）
- SKILL 预览
- SKILL 分类和标签
- SKILL 版本管理
- SKILL 导入/导出

---

### 2.5 RAG 知识库模块

#### 2.5.1 功能描述

RAG（Retrieval-Augmented Generation）模块提供知识库管理能力，支持文档的上传、向量化、检索，增强 Agent 的知识能力。

#### 2.5.2 支持的文档格式

| 格式 | 说明 |
|------|------|
| PDF | PDF 文档 |
| Word | .doc/.docx 文档 |
| Markdown | .md 文件 |
| Text | .txt 纯文本 |
| HTML | 网页文件 |

#### 2.5.3 知识库管理

**知识库配置：**
| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| name | string | 是 | 知识库名称 |
| description | string | 否 | 知识库描述 |
| embeddingModel | string | 是 | 向量化模型 |
| chunkSize | number | 否 | 分块大小 |
| chunkOverlap | number | 否 | 分块重叠 |
| enabled | boolean | 是 | 是否启用 |

**功能要求：**
- 知识库创建和管理
- 文档上传和删除
- 文档处理状态展示
- 知识库检索测试
- 知识库使用统计

---

### 2.6 Agent 交互模块

#### 2.6.1 功能描述

Agent 交互模块是用户与 AI Agent 进行对话的核心界面，支持多种 Agent 架构的选择和配置。

#### 2.6.2 支持的 Agent 架构

| 架构 | 说明 | 适用场景 |
|------|------|---------|
| ReAct | 思考-行动循环模式 | 需要工具调用的复杂任务 |
| AgenticRAG | RAG 增强的 Agent | 需要知识检索的问答任务 |
| PlanAndExecute | 计划-执行模式 | 需要多步骤规划的任务 |
| Reflexion | 反思改进模式 | 需要自我改进的任务 |

#### 2.6.3 会话管理

- 会话列表展示
- 会话创建和删除
- 会话历史查看
- 会话重命名
- 会话配置保存

#### 2.6.4 对话配置

| 配置项 | 说明 |
|--------|------|
| Agent 架构 | 选择使用的 Agent 架构 |
| 模型选择 | 选择使用的 LLM 模型 |
| 知识库选择 | 选择要检索的知识库（多选） |
| MCP 工具选择 | 选择可用的 MCP 工具（多选） |
| SKILL 选择 | 选择可用的 SKILL（多选） |

#### 2.6.5 交互展示

**思考过程展示：**
- Agent 的推理过程
- 工具调用决策
- 知识检索过程

**操作过程展示：**
- 工具调用详情（工具名、参数、结果）
- 知识检索结果
- SKILL 执行过程

**消息类型：**
| 类型 | 说明 |
|------|------|
| user | 用户消息 |
| assistant | Agent 回复 |
| thinking | 思考过程 |
| tool_call | 工具调用 |
| tool_result | 工具结果 |
| retrieval | 知识检索 |
| error | 错误信息 |

---

### 2.7 多用户系统

#### 2.7.1 功能描述

多用户系统提供用户认证、授权和资源隔离能力。

#### 2.7.2 用户角色

| 角色 | 权限说明 |
|------|---------|
| admin | 超级管理员，拥有所有权限 |
| manager | 管理员，可管理用户和部分系统配置 |
| developer | 开发者，可管理 SKILL、规则、MCP 等 |
| user | 普通用户，仅可使用 Agent 对话 |

#### 2.7.3 权限模块

| 模块 | 权限项 |
|------|--------|
| 会话 | 创建、查看、删除 |
| 模型 | 查看、配置、使用 |
| MCP | 查看、配置、连接管理 |
| SKILL | 查看、创建、编辑、删除 |
| 知识库 | 查看、创建、上传、删除 |
| 规则引擎 | 查看、创建、编辑、删除 |
| 用户管理 | 查看、创建、编辑、删除 |
| 系统设置 | 查看、修改 |

#### 2.7.4 功能要求

- 用户注册/登录
- 用户信息管理
- 角色管理
- 权限分配
- 操作日志

---

## 3. 非功能需求

### 3.1 性能需求

| 指标 | 要求 |
|------|------|
| 接口响应时间 | 普通接口 < 200ms |
| 并发用户数 | 支持 100+ 并发用户 |
| SSE 并发连接 | 单实例支持 1000+ AG-UI 流 |
| 消息延迟 | 实时消息延迟 < 100ms |

### 3.2 可用性需求

| 指标 | 要求 |
|------|------|
| 系统可用性 | 99.9% |
| 故障恢复时间 | < 5 分钟 |
| 数据备份 | 每日增量备份，每周全量备份 |

### 3.3 安全需求

| 方面 | 要求 |
|------|------|
| 认证 | JWT Token 认证 |
| 传输 | HTTPS/WSS 加密 |
| 存储 | 敏感数据加密存储 |
| 审计 | 关键操作日志记录 |

### 3.4 兼容性需求

| 方面 | 要求 |
|------|------|
| 浏览器 | Chrome 90+、Firefox 88+、Edge 90+、Safari 14+ |
| 屏幕 | 支持响应式布局，最小宽度 1024px |
| 移动端 | 暂不支持，后续版本考虑 |

---

## 4. 界面需求

### 4.1 主界面（Agent 对话页）

```
┌─────────────────────────────────────────────────────────────────────┐
│  Agentex                                              [用户头像]    │
├───────────────┬─────────────────────────────────────────────────────┤
│               │                                                     │
│  会话历史     │                   对话区域                           │
│               │                                                     │
│  ┌─────────┐  │  ┌─────────────────────────────────────────────┐   │
│  │ 会话 1  │  │  │ 👤 用户: 请帮我查询服务器状态                │   │
│  ├─────────┤  │  └─────────────────────────────────────────────┘   │
│  │ 会话 2  │  │                                                     │
│  ├─────────┤  │  ┌─────────────────────────────────────────────┐   │
│  │ 会话 3  │  │  │ 🤔 思考中...                                  │   │
│  └─────────┘  │  │ > 分析用户意图                               │   │
│               │  │ > 选择工具: server_status                    │   │
│               │  └─────────────────────────────────────────────┘   │
│               │                                                     │
│               │  ┌─────────────────────────────────────────────┐   │
│               │  │ 🔧 调用工具: server_status                   │   │
│               │  │ 参数: {}                                      │   │
│               │  │ 结果: { status: "online", players: 10 }      │   │
│               │  └─────────────────────────────────────────────┘   │
│               │                                                     │
│               │  ┌─────────────────────────────────────────────┐   │
│               │  │ 🤖 Agent: 服务器当前状态正常，在线玩家 10 人  │   │
│               │  └─────────────────────────────────────────────┘   │
│               │                                                     │
│               ├─────────────────────────────────────────────────────┤
│               │  ┌─────────────────────────────────────────────┐   │
│               │  │ [Agent架构▼] [知识库▼] [工具▼] [SKILL▼]      │   │
│  ┌─────────┐  │  │                                               │   │
│  │👤 用户名 │  │  │  请输入您的问题...                           │   │
│  │⚙️ 设置  │  │  │                                               │   │
│  └─────────┘  │  │                        [模型选择▼] [发送]     │   │
│               │  └─────────────────────────────────────────────┘   │
└───────────────┴─────────────────────────────────────────────────────┘
```

### 4.2 设置页面

```
┌─────────────────────────────────────────────────────────────────────┐
│  ← 返回                设置                                         │
├───────────────┬─────────────────────────────────────────────────────┤
│               │                                                     │
│  ┌─────────┐  │                    内容区域                         │
│  │ 👤 个人  │  │                                                     │
│  │    信息  │  │   根据左侧选择的栏目显示对应的内容                  │
│  └─────────┘  │                                                     │
│               │                                                     │
│  ─ 资源管理 ─  │                                                     │
│  ┌─────────┐  │                                                     │
│  │ 🤖 模型  │  │                                                     │
│  │    管理  │  │                                                     │
│  ├─────────┤  │                                                     │
│  │ 🔌 MCP  │  │                                                     │
│  │    连接  │  │                                                     │
│  ├─────────┤  │                                                     │
│  │ 📚 知识  │  │                                                     │
│  │    库    │  │                                                     │
│  ├─────────┤  │                                                     │
│  │ 🎯 SKILL│  │                                                     │
│  │    管理  │  │                                                     │
│  ├─────────┤  │                                                     │
│  │ ⚡ 规则  │  │                                                     │
│  │    引擎  │  │                                                     │
│  └─────────┘  │                                                     │
│               │                                                     │
│  ─ 系统管理 ─  │                                                     │
│  ┌─────────┐  │                                                     │
│  │ 👥 用户  │  │                                                     │
│  │    管理  │  │                                                     │
│  ├─────────┤  │                                                     │
│  │ ⚙️ 系统 │  │                                                     │
│  │    设置  │  │                                                     │
│  └─────────┘  │                                                     │
│               │                                                     │
└───────────────┴─────────────────────────────────────────────────────┘
```

### 4.3 设置页面各栏目内容

#### 4.3.1 个人信息
- 头像设置
- 用户名
- 邮箱
- 密码修改
- API 密钥管理

#### 4.3.2 模型管理
- 模型列表（表格形式）
- 添加/编辑模型弹窗
- 模型测试按钮
- 默认模型设置

#### 4.3.3 MCP 连接
- 标准 MCP 连接列表
- WS-MCP 连接列表
- 添加/编辑连接弹窗
- 连接状态显示
- 工具列表展示

#### 4.3.4 知识库
- 知识库列表
- 知识库详情（文档列表）
- 文档上传
- 知识库配置

#### 4.3.5 SKILL 管理
- SKILL 列表
- SKILL 编辑器
- SKILL 预览

#### 4.3.6 规则引擎
- 规则列表
- 可视化规则编辑器
- 规则测试
- 规则日志

#### 4.3.7 用户管理（仅管理员可见）
- 用户列表
- 用户详情/编辑
- 角色分配
- 权限配置

#### 4.3.8 系统设置（仅管理员可见）
- 全局配置
- 日志级别
- 备份设置
- 系统信息

---

## 5. 术语表

| 术语 | 全称 | 说明 |
|------|------|------|
| MCP | Model Context Protocol | 模型上下文协议，用于扩展 LLM 能力 |
| WS-MCP | WebSocket MCP | 基于 WebSocket 的 MCP 扩展协议 |
| AG-UI | Agent-User Interaction Protocol | Agent 用户交互协议，前后端 Agent 通信标准 |
| RAG | Retrieval-Augmented Generation | 检索增强生成 |
| SKILL | - | 技能模板，Markdown 格式的任务定义 |
| ReAct | Reasoning and Acting | 推理与行动循环的 Agent 架构 |
| LLM | Large Language Model | 大语言模型 |
| Agent | - | 智能代理，能够自主执行任务的 AI 系统 |
| SSE | Server-Sent Events | 服务端推送事件，用于流式响应 |

---

## 6. 附录

### 6.1 相关文档

- [系统架构设计](./SystemArchitecture.md)
- [后端模块设计](./BackendDesign.md)
- [前端界面设计](./FrontendDesign.md)
- [数据库设计](./DatabaseDesign.md)
- [API 接口设计](./APIDesign.md)
- [开发计划](./DevelopmentPlan.md)
- [WS-MCP 协议规范](./CustomizeWsMessageProcotol.md)
